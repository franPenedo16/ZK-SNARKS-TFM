## CIRCOM

### Description
Circom is a high-level domain-specific language for defining arithmetic circuits in the form of R1CS (Rank-1 Constraint System). Write templates and constraints in .circom files, compile them with the Circom compiler, and generate the proving and verification keys.
For proof generation and verification, the common workflow uses snarkJS, which takes the compiled circuit and inputs to produce a zk-SNARK proof and a public verification key.

### Version Used

Circom compiler: 2.2.2

### Installation
Follow the official guide for installation:
https://docs.circom.io/getting-started/installation/

### Files

- **circuit_js/**: 
Directory containing the JavaScript artifacts generated by the Circom compiler, including the circuit’s WebAssembly code and helper scripts for witness calculation.

- **circuit_0000.zkey**:
The first phase output of the trusted setup ceremony, containing an initial accumulator of cryptographic keys.

- **circuit_0001.zkey**:
The second (and final) phase of the trusted setup, incorporating contributions to produce the complete proving and verification keys.

- **circuit.circom**:
The source file written in the Circom DSL, defining the R1CS constraints and templates for the circuit.

- **circuit.r1cs**:
The compiled Rank-1 Constraint System representation of the circuit, used by snarkJS for witness generation and proof setup.

- **input.json**:
JSON file with the public and private inputs to the circuit (e.g., DNI, password hash, Sudoku problem and solution).

- **proof.json**:
The zk-SNARK proof object produced by snarkJS, containing all elements needed to verify the proof off-chain.

- **public.json**:
A JSON file listing only the public inputs and outputs revealed by the proof (e.g., DNI letter, password hash, Sudoku puzzle).

- **verification_key.json**:
The verification key generated by snarkJS, required by any verifier to check the validity of proof.json against public.json.

- **witness.wtns**:
The binary witness file computed from input.json and the circuit’s WebAssembly; it encodes all intermediate values needed for proof generation.


### Commands to generate the proof


`npm install circomlib` => Installs the circomlib package, which includes cryptographic circuits and utilities (Poseidon, MiMC, eddsa, etc.).


`circom circuit.circom --r1cs --wasm` => Compiles circuit.circom and generates:

- circuit.r1cs (the R1CS constraint system)

- circuit_js/circuit.wasm (WASM module for witness calculation)


`node circuit_js/generate_witness.js circuit_js/circuit.wasm input.json witness.wtns` => Runs the WASM module with input.json to produce witness.wtns, containing all intermediate values needed for the proof.

**PTAU**

`snarkjs powersoftau new bn128 12 pot12_0000.ptau -v` => starts the ceremony for the BN128 curve with scale 2¹², creating pot12_0000.ptau

`snarkjs powersoftau contribute pot12_0000.ptau pot12_0001.ptau --name="First contribution" -v` => adds user input entropy, producing pot12_0001.ptau.

`snarkjs powersoftau prepare phase2 pot12_0001.ptau pot12_final.ptau -v` => finalizes the ceremony to produce pot12_final.ptau, ready for Groth16.

**Verification key**

`snarkjs groth16 setup circuit.r1cs pot12_final.ptau circuit_0000.zkey` => creates the initial key circuit_0000.zkey.

`snarkjs zkey contribute circuit_0000.zkey circuit_0001.zkey --name="1st Contributor Name" -v` => adds user input contribution and produces the final key circuit_0001.zkey.

`snarkjs zkey export verificationkey circuit_0001.zkey verification_key.json` => extracts the verification key to verification_key.json.

**Proof**

`snarkjs groth16 prove circuit_0001.zkey witness.wtns proof.json public.json` =>  generates proof.json (the proof) and public.json (the public inputs).

`snarkjs groth16 verify verification_key.json public.json proof.json` => checks that proof.json is valid against verification_key.json and public.json.